{
  "info": {
    "name": "Test Scenario",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    }
  ],
  "item": [
    {
      "name": "Create User1",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{base_url}}/admin/users", "host": [ "{{base_url}}" ], "path": [ "admin", "users" ] },
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"User1\", \"email\": \"user1@example.com\"}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Создан user1 - статус 201\", function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "var user1 = pm.response.json();",
              "pm.environment.set(\"user1_id\", user1.id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Create User2",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{base_url}}/admin/users", "host": [ "{{base_url}}" ], "path": [ "admin", "users" ] },
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"User2\", \"email\": \"user2@example.com\"}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Создан user2 - статус 201\", function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "var user2 = pm.response.json();",
              "pm.environment.set(\"user2_id\", user2.id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Create Category",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{base_url}}/admin/categories", "host": [ "{{base_url}}" ], "path": [ "admin", "categories" ] },
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Test Category\"}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Создана категория - статус 201\", function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "var category = pm.response.json();",
              "pm.environment.set(\"category_id\", category.id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Create Event",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{base_url}}/users/{{user1_id}}/events", "host": [ "{{base_url}}" ], "path": [ "users", "{{user1_id}}", "events" ] },
        "body": {
          "mode": "raw",
          "raw": "{\"annotation\":\"Test Annotation for Commented Event\", \"category\":{{category_id}}, \"description\":\"Test Description for Commented Event\", \"eventDate\":\"2025-02-25 19:21:57\", \"location\":{\"lat\":-67.072, \"lon\":83.6998}, \"paid\":false, \"participantLimit\":2, \"requestModeration\":true, \"title\":\"Test Event\"}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Создан event - статус 201\", function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "var event = pm.response.json();",
              "pm.environment.set(\"event_id\", event.id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Publish Event",
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{base_url}}/admin/events/{{event_id}}", "host": [ "{{base_url}}" ], "path": [ "admin", "events", "{{event_id}}" ] },
        "body": {
          "mode": "raw",
          "raw": "{\"stateAction\":\"PUBLISH_EVENT\"}"
        }
      }
    },
    {
      "name": "Create Comment",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{base_url}}/users/{{user2_id}}/comments", "host": [ "{{base_url}}" ], "path": [ "users", "{{user2_id}}", "comments" ] },
        "body": {
          "mode": "raw",
          "raw": "{\"eventId\": {{event_id}}, \"text\": \"Отличное событие!\"}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Создан комментарий - статус 201\", function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "var comment = pm.response.json();",
              "console.log(\"Комментарий создан: \" + comment.id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ]
}
